<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>車庫 / 商店</title>
    <link rel="stylesheet" href="style.css">
    <script src="api.js"></script>
</head>

<body>
    <header class="site-header">
        <div class="header-inner">
            <!-- 左邊：logo + 導覽連結，全靠左 -->
            <div class="header-left">
                <div class="header-logo"> TC2 DB</div>
                <nav class="header-nav">
                    <a href="home.html" class="nav-link">首頁</a>
                    <a href="leaderboard.html" class="nav-link">排行榜</a>
                    <a href="trade.html" class="nav-link nav-link-active">交易中心</a>
                </nav>
            </div>

            <!-- 右邊：profile icon（只剩這一顆） -->
            <div class="header-right">
                <div class="profile-icon" id="nav-profile-icon"></div>
            </div>
        </div>
    </header>
    <div class="app">
        <div class="nav">
            <a href="profile.html">個人資料</a>
            <a href="leaderboard.html">排行榜</a>
            <a href="shop.html">車庫 / 商店</a>
            <a href="index.html">登出</a>
        </div>

        <h1>二手車市場</h1>
        <table id="used-table">
            <thead>
                <tr>
                    <th>賣家</th>
                    <th>品牌</th>
                    <th>車款</th>
                    <th>價格</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <p id="shop-msg"></p>
    </div>

    <script>
        function loadUsedCars() {
            apiGetUsedCars().then(cars => {
                const tbody = document.querySelector("#used-table tbody");
                tbody.innerHTML = "";
                cars.forEach(c => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
            <td>${c.seller}</td>
            <td>${c.brand}</td>
            <td>${c.model}</td>
            <td>${c.price}</td>
            <td><button data-id="${c.playerCarId}">買下</button></td>
          `;
                    tbody.appendChild(tr);
                });

                tbody.querySelectorAll("button").forEach(btn => {
                    btn.addEventListener("click", () => {
                        const id = btn.getAttribute("data-id");
                        apiBuyCar(id).then(res => {
                            if (res && res.success) {
                                document.getElementById("shop-msg").innerText = "購買成功（目前為假資料示範）";
                            } else {
                                document.getElementById("shop-msg").innerText = "購買失敗";
                            }
                        });
                    });
                });
            });
        }

        loadUsedCars();
    </script>
</body>

</html>